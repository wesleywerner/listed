<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
      <title>Listed - Predictive Shopping</title>
      <meta http-equiv="content-type" content="text/html;charset=utf-8" />
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
      <!-- css animations -->
      <link rel="stylesheet" href="css/animate.min.css">
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
    <body>
      <div id="app">

        <div class="progress" v-show="loading">
            <div class="indeterminate"></div>
        </div>
  
        <!-- Main navigation -->
        <nav class="nav-extended" v-bind:class="color" role="navigation" v-show="!loading" style="display:none">
          <div class="nav-wrapper container">
            
            <a id="logo-container" href="#recommendedPopup" class="brand-logo" v-on:click="predictFrequencies">
              <i class="material-icons medium animated" v-bind:class="{ 'infinite tada': hiliteRecommendations }">stars</i>Listed</a>
            
            <!-- recommendedPopup toggle -->
            
            <!-- Status icons -->
            <ul class="right">
              <li>
                <i class="material-icons" v-show="!saved" title="unsaved changes">mode_edit</i>
              </li>
            </ul>
            
          </div>

          <!-- nav tabs -->
          <div class="nav-content">
            <ul class="tabs tabs-transparent">
              <li class="tab"><a href="#listContent" class="active">List</a></li>
              <li class="tab"><a href="#dataContent">Data</a></li>
              <li class="tab"><a href="#configContent">Config</a></li>
            </ul>
          </div>
    
        </nav>
  
        <div class="container" v-show="!loading" style="display:none">
          <div class="section">

            <!-- tab contents -->
            <div id="listContent" class="col s12">
              
              <!-- auto complete history items -->
              <item-autocomplete id="item-input" 
                auto-clear="true" 
                placeholder="I want..."
                show-button="true"
                v-bind:history="history" 
                v-on:selected="addItem(arguments[0])"></item-autocomplete>
                
              <!-- list of check items -->
              <ul class="collection" v-show="list.length > 0">
                <transition-group name="list-transition" tag="ul" enter-active-class="animated flipInX" leave-active-class="animated flipOutX">
                  <list-item class="collection-item" 
                    v-for="(item, index) in list" 
                    v-bind:key="item"
                    v-bind:id="'listItem' + index"
                    v-bind:item="item" 
                    v-on:remove="removeItem(arguments[0])"
                    v-on:checked="addHistory(arguments[0])"
                    v-on:unchecked="undoHistory(arguments[0])">

                  </list-item>
                </transition-group>
              </ul>
              
              <!-- clear list action -->
              <div class="row">
                <div class="col sm2">
                  <button type="button" class="waves-effect waves-light btn" v-show="list.length > 0" v-on:click="promptCleanList">Clean</button>
                </div>
              </div>

              <!-- no data information -->
              <transition name="howto-transition" enter-active-class="animated flipInX" leave-active-class="animated flipOutX">
                <div class="row" v-show="hiliteRecommendations">
                  <div class="col s12 m6">
                    <div class="card blue lighten-4">
                      <div class="card-content black-text">
                        <span class="card-title">How does this work?</span>
                        <p>Add some items that you want to your list up above. I will remember the dates you check them off the list, and after about 2 rounds I can start predicting when you next need that nice something.</p>
                        <p>Use the <i class="material-icons">stars</i> icon above to see my recommendations.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </transition>

            </div>
            
            <div id="dataContent" class="col s12">

              <button type="button" class="btn" onclick="addTestData()">Add Test Data</button>
              <div class="row">
                <div class="col s12">
                  <ul class="tabs tabs-fixed-width">
                    <li class="tab col s3"><a href="#dataItems" class="active">Items</a></li>
                    <li class="tab col s3"><a href="#dataMerge">Merge</a></li>
                  </ul>
                </div>
                <div id="dataItems" class="col s12">
                  <table class="bordered striped responsive-table">
                    <thead>
                      <tr>
                        <td>Name</td>
                        <td>Data Points</td>
                        <td></td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="hist in history">
                        <td>{{ hist.text }}</td>
                        <td><button class="waves-effect waves-teal btn-flat" v-on:click="showHistoryDates(hist)">{{ hist.dates.length }}</button></td>
                        <td><button class="waves-effect waves-teal btn-flat" v-on:click="promptRemoveHistory(hist)">remove</button></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div id="dataMerge" class="col s12">
                  <merge-selection v-bind:history="history" v-on:do-merge="promptMerge(arguments[0], arguments[1])"></merge-selection>
                </div>
              </div>
              
            </div>

            <div id="configContent" class="col s12">
              <h5>Flavour</h5>
              <div class="collection">
                <a href="#!" v-on:click="setColor('red')" class="collection-item lighten-1 black-text red">Tomato</a>
                <a href="#!" v-on:click="setColor('pink')" class="collection-item lighten-1 black-text pink">Cherry</a>
                <a href="#!" v-on:click="setColor('purple')" class="collection-item lighten-1 black-text purple">Grape</a>
                <a href="#!" v-on:click="setColor('indigo')" class="collection-item lighten-1 black-text indigo">Blueberry</a>
                <a href="#!" v-on:click="setColor('cyan')" class="collection-item lighten-1 black-text cyan">Bubblegum</a>
                <a href="#!" v-on:click="setColor('green')" class="collection-item lighten-1 black-text green">Celery</a>
                <a href="#!" v-on:click="setColor('lime')" class="collection-item lighten-1 black-text lime">Lime</a>
                <a href="#!" v-on:click="setColor('amber')" class="collection-item lighten-1 black-text amber">Honey</a>
                <a href="#!" v-on:click="setColor('deep-orange')" class="collection-item lighten-1 black-text deep-orange">Guava</a>
                <a href="#!" v-on:click="setColor('grey')" class="collection-item lighten-1 black-text grey">Neutral</a>
              </div>
            </div>
          
          </div>  <!-- /section -->
        </div>  <!-- container -->

         <!-- recommended items modal -->
        <div id="recommendedPopup" class="modal bottom-sheet">
          <div class="modal-content">
            <h5><i class="material-icons">star</i> Recommended</h5>
            
            <p v-show="recommendations.length == 0">As I learn more about how often you tick certain items, I will be able to recommend them here in the future.</p>

            <ul class="collection" v-show="recommendations.length > 0">
              <li class="collection-item lighten-4" v-for="pred in recommendations" v-bind:class="{ red:pred.dueDays < 1 }">
                {{ pred.text }}, due {{ pred.dueDate }}
                <a href="#!" class="secondary-content" title="Add to my list" v-on:click="addItem(pred.text)"><i class="material-icons">send</i></a>
              </li>
            </ul>
            
          </div>
        </div>
  
      </div>  <!-- /app -->

      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script type="text/javascript" src="js/materialize.min.js"></script>
      <script type="text/javascript" src="js/materialize.init.js"></script>
      <script type="text/javascript" src="js/localforage.min.js"></script>
      <script type="text/javascript" src="js/vue.min.js"></script>
      <script type="text/javascript" src="js/moment.min.js"></script>
      <script type="text/javascript" src="js/listed.components.js"></script>
      <script type="text/javascript" src="js/listed.js"></script>
      <script type="text/javascript" src="js/listed.ui.js"></script>
      <script type="text/javascript" src="js/listed.bind.js"></script>
      
      <!-- dev data -->
      <script>
        function addTestData() {
          var text = prompt('name of item to generate');
          if (text == undefined) return;
          var avg = prompt('average purchase frequency in days');
          if (avg == undefined) return;
          var lastBought = prompt('how many days ago was the item last bought');
          if (lastBought == undefined) return;
          var lastDate = moment().subtract(parseInt(lastBought), 'days');
          for (var i=6; i>-1; i--) {
            Listed.methods.addHistory(text, moment(lastDate).subtract(i*avg, 'days').format('YYYY-MM-DD'));
          }
          Listed.methods.predictFrequencies();
        }
      </script>
      
    </body>
</html>
