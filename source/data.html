<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
      <title>Shopt</title>
      <meta http-equiv="content-type" content="text/html;charset=utf-8" />
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
      <!-- css animations -->
      <link rel="stylesheet" href="css/animate.min.css">
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
<!--
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   any later version.
   
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with this program. If not, see http://www.gnu.org/licenses/.
-->
    <body>
      <div id="app" class="lighten-5" v-bind:class="color" style="height:100%; min-height:100vh;">

        <div class="progress" v-show="loading">
            <div class="indeterminate"></div>
        </div>
  
        <!-- Main navigation -->
        <navigation 
          v-show="!loading" style="display:none"
          v-bind:view="'data'"
          v-bind:color="color"
          v-bind:saved="saved"
          v-on:navaction="window.location = 'index.html'"
          >
        </navigation>
        
        <div class="container" v-show="!loading" style="display:none">
          <div class="section">

              <div class="row">
                <div class="col s12">
                  <ul class="tabs">
                    <li class="tab col s3"><a href="#dataItems" class="active">Items</a></li>
                    <li class="tab col s3"><a href="#dataMerge">Merge</a></li>
                  </ul>
                </div>
                <div id="dataItems" class="col s12">
                  <table class="bordered striped responsive-table">
                    <thead>
                      <tr>
                        <td>Name</td>
                        <td>Data Points</td>
                        <td></td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="hist in history">
                        <td><button class="waves-effect waves-teal btn-flat" v-on:click="promptRename(hist)">{{ hist.text }}</button></td>
                        <td><button class="waves-effect waves-teal btn-flat" v-on:click="showHistoryDates(hist)">{{ hist.dates.length }}</button></td>
                        <td><button class="waves-effect waves-teal btn-flat" v-on:click="promptRemoveHistory(hist)">remove</button></td>
                      </tr>
                    </tbody>
                  </table>
                  <button type="button" class="btn waves-effect" onclick="addTestData()">Add Test Data</button>
                </div>
                <div id="dataMerge" class="col s12">
                  <merge-selection v-bind:data="sortedHistory" v-on:do-merge="promptMerge(arguments[0], arguments[1])"></merge-selection>
                </div>
              </div>
              
          </div>  <!-- /section -->
        </div>  <!-- container -->
  
      </div>  <!-- /app -->

      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script type="text/javascript" src="js/materialize.min.js"></script>
      <script type="text/javascript" src="js/materialize.init.js"></script>
      <script type="text/javascript" src="js/vue.min.js"></script>
      <script type="text/javascript" src="js/moment.min.js"></script>
      <script type="text/javascript" src="js/polyfills.js"></script>
      <script type="text/javascript" src="js/shopt.components.js"></script>
      <script type="text/javascript" src="js/shopt.logic.js"></script>
      <script type="text/javascript" src="js/shopt.ui.js"></script>
      <script type="text/javascript" src="js/shopt.bind.js"></script>
      
      <!-- dev data -->
      <script>
        function addTestData() {
          var text = prompt('name of item to generate');
          if (text == undefined) return;
          var avg = prompt('average purchase frequency in days');
          if (avg == undefined) return;
          var lastBought = prompt('how many days ago was the item last bought');
          if (lastBought == undefined) return;
          var lastDate = moment().subtract(parseInt(lastBought), 'days');
          for (var i=12; i>-1; i--) {
            Shopt.methods.addHistory(text, moment(lastDate).subtract(i*avg, 'days').format('YYYY-MM-DD'));
            // add variance
            if (Math.random() < 0.1) {
              Shopt.methods.addHistory(text, moment(lastDate).subtract(i*avg-1, 'days').format('YYYY-MM-DD'));
            }
          }
          Shopt.methods.predictFrequencies();
        }
      </script>
      
    </body>
</html>
